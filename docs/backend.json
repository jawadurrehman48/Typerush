
{
  "entities": {
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user's profile within the TypeRush application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "username": {
          "type": "string",
          "description": "The user's chosen username."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture."
        },
        "highestWPM": {
          "type": "number",
          "description": "The user's highest recorded typing speed (words per minute)."
        },
        "gamesPlayed": {
          "type": "number",
          "description": "The total number of games the user has played."
        }
      },
      "required": [
        "id",
        "username",
        "email",
        "highestWPM",
        "gamesPlayed"
      ]
    },
    "Game": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Game",
      "type": "object",
      "description": "Represents a single game played by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Game entity."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who played the game."
        },
        "score": {
          "type": "number",
          "description": "The score (WPM) achieved in the game."
        },
        "accuracy": {
            "type": "number",
            "description": "The typing accuracy percentage."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp indicating when the game was played.",
          "format": "date-time"
        }
      },
      "required": ["id", "userId", "score", "accuracy", "timestamp"]
    },
    "LeaderboardEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LeaderboardEntry",
      "type": "object",
      "description": "Represents a single entry on the leaderboard.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the LeaderboardEntry entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N LeaderboardEntry)"
        },
        "username": {
          "type": "string",
          "description": "The username associated with this leaderboard entry."
        },
        "score": {
          "type": "number",
          "description": "The score achieved by the user."
        },
        "accuracy": {
            "type": "number",
            "description": "The typing accuracy percentage."
        },
        "timestamp": {
          "type": "string",
          "description": "The timestamp indicating when the score was achieved.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "username",
        "score",
        "accuracy",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile data. Path-based ownership ensures only the authenticated user can access their profile. Includes 'id', 'username', 'email', 'highestWPM', and 'gamesPlayed'.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user, corresponding to their Firebase Authentication UID."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/games/{gameId}",
        "definition": {
          "entityName": "Game",
          "schema": {
            "$ref": "#/backend/entities/Game"
          },
          "description": "Stores the history of games played by a specific user. Path-based ownership ensures only the authenticated user can access their own game history.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "gameId",
              "description": "The unique identifier for the game entry."
            }
          ]
        }
      },
      {
        "path": "/leaderboard/{leaderboardEntryId}",
        "definition": {
          "entityName": "LeaderboardEntry",
          "schema": {
            "$ref": "#/backend/entities/LeaderboardEntry"
          },
          "description": "Stores leaderboard entries. Includes denormalized 'username' from UserProfile for authorization independence. Includes 'userId', 'username', 'score', and 'timestamp'.",
          "params": [
            {
              "name": "leaderboardEntryId",
              "description": "The unique identifier for the leaderboard entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support user authentication (email/password, guest), profile storage, leaderboard functionality, and game statistics tracking in the TypeRush application. The structure prioritizes authorization independence and clear security rules. User profiles are stored in a private collection `/users/{userId}`, ensuring only the authenticated user can access their own profile. A subcollection `/users/{userId}/games` stores a user's individual game history. Leaderboard entries are stored in a global collection `/leaderboard`, allowing efficient querying and display of top scores. The `username` is denormalized into the `LeaderboardEntry` documents to avoid needing to perform a `get()` operation from the `users` collection in security rules to ensure that the user still has that username. This is critical for atomic updates. All reads on the `leaderboard` collection can be granted if the `username` matches the user and the `userId` is valid."
  }
}

    